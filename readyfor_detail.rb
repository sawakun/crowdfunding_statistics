# URLにアクセスするためのライブラリの読み込み
require 'open-uri'
# Nokogiriライブラリの読み込み
require 'nokogiri'

# スクレイピング先のURL
base_url = 'https://readyfor.jp/projects/'
#projects = ['kurogane4ki', 'tsukiji_wonderland', 'an_empty_library', 'okinawa_toy_museum', 'jabujabu-ike', 'ozu_remastering', 'kikkakebus', 'higashiyama', 'watanohaSmile', 'igo13ro', 'idiocy', 'itnav_1107', 'fukuribiiryoyowig-photo', 'BANANAPAPER', 'donbosco', 'ootanitosyokan', 'isak2014', 'hoketsuoen', 'happynekochan', 'japanheart_vol1', 'minnacafe', 'aedsos', 'tsunagaru_library', 'sagantosu_kizuna', 'napkin', '_ccj', 'yumeno_kakehashi', 'ishinomaki_20', 'senseinote', 'girls-square', 'peacebridge2014', 'ootanitoshokan2', 'isak2013', 'Co-Dreamer', 'daredemohero', 'susa', 'Coffret', 'tohokumama', 'otsuchi-future-paper', 'ishinomo-kitchin', 'minamiminami', 'kamaishi', 'uminchumaru', 'cosmos', 'siawase', 'hamadan811', 'miratuku', 'rett', 'kiriharete_hikarikitaru_haru', 'mintosho', 'shimabooks', 'MekongBlue', 'AoSI2013', 'startup-itoden', 'KesenTsubakiDream', 'ai-tsunagu-project', 'otonanosenaka', 'asobiba', 'f-c-p', 'lomeo', 'cacaochild', 'newjob', 'studioDAN', 'haikaragohan', 'sanrikujin', 'minorimama', 'haichi-doctor', 'BLUETRAIN', 'slumschool', 'kuribora', 'On_The_Road', '1024', 'somaliland_doragon', 'cambodia', 'arifes', 'JA_BALLET', 'takashirohamayumehouse', 'renoa-atopy-sweets', 'Lynne2014', 'yuubari-mintosho', 'afrimedico', 'andu_amet', 'shirayukihime', 'ikihug', 'shala', 'kesencha', 'idouhoiku', 'NAKA_JIMBEI', 'fukui_jin', 'iclub_kesennuma', 'tanami_gekijyo', 'picot', 'fujisan3776', 'telework', 'uchuuzu', 'fng-lib', 'tohoku2_musical', 'greenbird', 'sisal', 'gohoo', 'shinrinno', 'bangladeshschool', 'oft-tsunami-museum', 'OnagawaFish', 'kesen_shienpj_danwa', 'congo-ultimate', 'wonderartproduction', 'eboard', 'goshigoshi-fukushima', 'minnanoie', 'mikari_volley', 'standformothers', 'soccer-goal', 'hero_cambodia_school', '311archive', 'CLPP2013', 'komera-summer2014', '311ba', 'enami_photobook01', 'purako', 'brazil-soccer-peaceball', 'niconicogakkai', 'soma-yaki2014', 'choshijin', 'edaya', 'mysecondopinion', 'nethukikyu', '1103', 'cmam1774', 'tenten', '907', 'paratriathlon', 'jeefgulahe', 'myanmar_picturebook', 'fablab', 'GCM_fukushima', 'bokunoniji', 'kibamusha-rockfes-minamisouma', 'kokoroken-somekobo', 'HRI_CAMBODIA', 'kiminote', 'TSUNAGARI', 'ac_taiwan2013', 'e-Farming', 'j-wave_miyakejima', 'dreamletter', 'f-piece', 'ama-library', 'fukushima_kids_dolphin', 'jffid', 'fukubien2012', 'iddm-picture-book1', 'hero-pampit', 'ecovillage', 'omodoc', 'ciemadigital', 'asobikichi2', 's-dog', 'TEAM_MARU', 'FIGHTINGAID', 'concerttowordthepeace', 'hisaoka_book', 'pinkdotok', 'roma_doragon', 'hattatsu', 'alternafoodparty', 'SIAF_more-trees', 'happyice', '1751', 'oneline2013', 'hellolife', 'unimen', 'sanjokuki3', 'fd', 'MONSTERExhibition', 'web_naru001', 'worldkidsmuseum', 'yubari-yumesaiseikan_in-summer', 'Yamadadome', 'yumyam47', 'tranSMS', 'wakasa-umeshu', 'agroforestry', 'awaodori', 'saigaikyujonin', 'kodomokichi', 'satoumi-ama', 'books-sweethereafter', 'npolog', 'handinhand', 'minamisanriku-kodomonoasobiba', 'SPEC-JAPAN', 'sev2014', 'gaza_dragon', 'niranjanabus', '37nouta', 'lifemap', '37nouta2', 'papamamap', 'heal_heart_with_library117', 'LOMEO', 'mori_isamu', 'Secret_Factory', 'DreamTown', 'herbtea', 'world-disabledgolfchampionship', 'ryugansai', 'lp-exam', 'TSSA2013', 'ARAIFUZUKI', 'syria_refugee_film', 'gottman1103', 'mizuiku', 'okonomiyaki', 'jiailove', 'niconicogakkai3', 'artsforhope', 'Pay-forwardClub', 'acadexproject', 'tohoku_mirai', 'rfltokyoueno', 'daimon-cup', 'lapulapu_tungod', 'ozawatsuyoshi-artpj', 'tsukutsugu_3rd', 'tsukutsugu2nd', 'ayado-concert', 'nurseducation', 'npokoso', 'sanrikukaki', 'asayake', 'attaramon', 'niconicogakkai5', 'thesala20140920', 'palestine_dragon', 'hospitallive', 'KKCC', 'takarabako', 'goark', 'AOZORATAKENOKO', 'papa-aid', 'cambodia-library', 'underserved-youth', 'heart-school', 'kanapeace', 'bokunatsu2014', 'halle', 'DFCJ', 'tenohirani_taiyou', 'nerorism', 'okirai', 'DeniyayaTea2014', 'minsai', 'saltschool', 'lowlandjazz', 'fukushima', 'miraisbook', '766', 'touhoku_musical', 'ramen', 'kids_recipe', 'kmcproject', 'mushimushi', 'zyusanhama', 'medicinal-plants_cambodia', 'asudessan', 'KESENNUMA_dog-place', 'kidsdoor-foodbank', 'FoEfukushima', 'youthfor311', 'Rwiz_Village', 'trans-project', 'project-yui-0509', 'kenchikutaiso', 'tady', 'fashionshow', '194', 'leyte', 'asobikichi3', 'dougu-lab', 'wada1000days', 'tanpopo_0510', 'itojunichi', 'bokunatsu2013', 'baila-onagawa', 'Uganda_Wafula', 'Assistancedoglovememorial', 'ios-kyokasyo', 'lovekarte2014', 'sakamoto_hanabi', 'yumyum8888', 'greenconsumer', 'songdekyong2', 'magic', 'sister_school_project', 'shukatsu2013', '31', 'FUKUSHIMA_ORGANIC_COTTON_PJ', 'kodomonomori', 'second-academy', 'kuriharaseihou', 'microlibrary', 'savo', 'message311', 'ourplace', 'acacam2012s', 'bagmati', 'Rapidmasters', 'geisha', 'ifca', 'arinko_bunko', 'townsguild', 'tsukutsugu4th', 'earthwalkers', 'yuriage2', 'tottori', 'shingakukikin', 'VVV-craft', 'Cambodia_slum_library', 'ALIS-Anne', 'ouenza', 'wateraid', 'apple', 'SharetheWind', '416jishujohei', '1351', 'guatemala', 'fukushimaniaidemi', 'hanarart', 'phontoum', 'padm', 'vegetabo', 'sydneyrainbowstay', 'snowbank2011', 'kodohiro_project', 'houseofjoy', 'saga_delegation', 'cocoro_shien', 'tanadalove', 'rikuzentakata', 'peace-winds', 'cheremeie', 'FORTUNE-MIYAGI', 'weeawu', 'tsumari', 'oyaben', 'fukushima-itamu-mono-no-koe', 'chereyouth', '932', 'WORLDSTUDY', 'kizunakurisumasu', 'rone-gigi', 'gidayu-mirai', 'ipckodamataiko', 'kyoto-um01', 'samuraicurry', 'ftcj-india', 'terakoyalabo', 'ismjapan', 'bokunatsu', 'Bangladesh-techo', 'ajwrcyouth', 'Cruisearound1', 'hansen-india', 'nukeme_fablabshibuya_fakko', 'kurosakizine', 'ishinomaki-ballet', 'LGBT_Boris', 'FCC', 'tokyokoureisha', '1167', 'reco', 'some_kobo', 'demaerakugo', 'slum_the', 'asobikichi', 'wakuwakutour', 'enoshima_ex', 'fukufukuegao', 'morimae', 'ransinoroukaumi', 'dokodemo', 'mame-casu', 'mahounowa', 'tanourateam', 'hucref_cambodia', '978', '816siminkokaikoza', 'timney', 'hakkakutei', 'gakuseiplus', 'comfortablesleep', '311fortune', 'Impresa', 'cinemachi', 'teawase_sakura', '30', 'futures', 'IKUSA-01', 'dotdashfilm', 'yuichibass', 'worldrakugo', 'philippines_2nd', 'yosh_greenzjp', 'youthforbangla-japan', 'donnerlemot', 'dancer-project', 'dribble', 'BANGLA', 'asagaya', 'susumuafrica', 'canon_kokoromusubi', 'runfortohokujapan', 'social_business_lab', '929terafes', '1565', 'tetsuya', 'LCA_Tohoku_Camp', 'Scotland-Referendum', 'muginokai-fairtrade', 'yuriage', 'magazine9', 'SpaceApps2013', 'WelcomeAmy', 'fukushima-ishinomaki', 'guruguru', 'cambria_hanahuda', 'eritrea', 'FukushimaKidsMovie', 'Hediste_japonica', 'carsharing4', 'peacewalk', 'sekainoohukuro', 'SPORTSFORREVIVAL', 'kenya-library', 'kailabo', '1839', 'tohoku_study_tour', 'cocolin', 'daterock', '1182', 'bombies', 'diversitykobo', 'Are_Bra', 'kidogs', 'KidsFun', '14', 'omoinowa', 'japantrip2014', 'realghanachoco', 'hero-deaf-japan-prowrestling', 'satohama', 'honshu-odan', 'detroit_7', 'yomirepi', 'takarajima_bananafarm', 'microlibrary2014', 'asuhira_2013', 'hinatabocco', 'jindaijihozukimatsuri', 'discrimination-of-women', 'hearingdog-manga', 'ih_project_2014', 'HAPPYDAY', 'makotoauss', 'TEAM-SAMURAI', 'knkpalestine', 'comufarm', 'solomon_honey', 'cambodia-for-dream', '33', 'garekitphoto', 'plcl2012', 'kakigoori-car', 'utagoekissa', 'CHA-NO-YU', 'bridge_asia_japan_vn', 'OYASAI-Univ', 'bellmare', 'green-tree-woodworks', 'nepal-yagi', '1519', '1830', 'annaka-hidamari', 'toys4kids', 'littlemusical2nd', 'ikawako', 'socialworkeeerz', 'loy2014', 'socialmusic', 'photo', 'sfm-pamphlet', 'stage-afda-in-myanmer', 'FukushimaKodomo2013', 'EISA-ISHINOMAKI', 'guruguru2', 'Engawart', 'win3', '1814', 'myu-maru', 'SHINISE', 'daikazokugokko', 'egaonogift', 'npofine', 'tsubomi-project', 'IVUSA-Philippines', 'taberu_seiji', 'obento-project', 'mihonomatsubara-kikyu', 'acchi-cocchi', 'hawaiiart_exhibition', 'HeartBeat', '171', 'fukko-concert', 'dokusyokansoubun', 'deportaredays', 'tomoniaru_cinema', 'hitomiza-otome-bunraku', '7daysprogram', 'nerimaga', 'nagashizutenugui', 'neardesign', 'hahennokirameki', '783', 'umifes2014', 'hanamaru', 'EMS_StoNino', 'yumehenoippo', 'chanceseed', 'mauitaiko', 'tsubomigakko', 'sliiic-swc2014', 'sansonryuugaku2013', 'hidabito02', 'clcfukushima', 'kidsjobfes', 'datugenpatu', '1383', 'KOSOTSU', 'real_ykb', 'chiitabi', 'hapihapi10', 'hrn', 'lifepower', 'toden49shonai', 'bridgeforpeace_report', 'hibakupiano', 'KAWASAKISODACHI', 'harrisjtrip2014', 'showa-kayou', 'osakarugbyfamily', 'mmm2013', 'kurayami_bansankai', 'Bridgeforpeace', 'fukushima-kidscamp', 'tokitsunagi', 'nokinet', 'azumino_hikari_p', 'lgbtstudytour', 'childartresidence', 'kodomo-study', 'WithAnimal', '1004', 'ogawakokuren', 'loy2013', 'nijinijibowbowbowbow', 'waonmusic', '754', 'oshitani-farm', 'onsen-nyanko', 'sokoageyouth', 'shelf_volume16_noras', 'voice1', 'SNOWGIRL', 'kamishibai', 'scouts_japan_bangladesh', 'butfresh', 'kuji-sta', 'booklike', '8hiroba', 'hidabito04', 'KAJI', 'texpa2014', 'chuunanbei', 'artbookwho', '1326', 'projectG_WS_minamisouma', 'ikepon', 'nijojo', 'mamano_okataduke', 'sohub_bento', 'Tsunan_SnowFestival', 'peopledesign-mix', 'dreamghana', 'muaythai_shirou-childsupport', 'mightysilence', 'ISHURAN', 'little_akinai', 'bounenkai', 'human-harbor', 'cebfes-again', 'tsunagi', 'sake-dic', '1325', 'gakuseijazz-jazzline', 'maki-bo', 'UKJPYouthRadio', 'srilanka-family', 'smilegift-campaign', 'wharukouen', 'hahanohi2014present', 'earthgarden_FP25', 'kkbook', 'gift_a_lunch', 'terakoya', 'hidabito', 'fuwamoko', '4uworld', 'lighting_object', 'meijibarrierfree', '187lets-go-picnic', 'mahamuni-Xmas', 'sukure', 'tadazemi', 'nacef', 'HIRANO_RYO', 'DAISUKE_MIYOSHI', 'nadeshiko-voice', 'mograg_vol3', 'kanaeai1', 'awanone', 'sunshine_concert', 'made-in-tohoku-japan', 'Japan_Junction', 'okakmi_ayako', 'pearl', 'machinaka-yaoya', 'SWITCH', 'Paris-KURIHARA_229', 'active_challenge_2014', 'carsharing3', 'jazzballade', 'codomocamp', 'takuroban310', 'carsharing2', 'connectanzania', 'cebfes', 'FUKUSHIMA_sakurambotour', 'morizo', '21', 'casa_project', 'library4KFKO', 'hopelorega', 'missrikei', 'habicolle2014', 'moasia', 'christmas_party', 'carsharing', 'ichikawalionsclub2014', 'michinoku_caravan', 'kodomonomachi', 'JAM', 'yen_miraisozo', '974', 'shigaraki', 'tenkin-books', 'tadaimawoacchidemo', 'okumono', 'JournalismFesta2013', 'anan-chakai', 'hinkon_2014', 'event2012', 'makuhari', 'teamneighbor', '2014summercamp', 'kesenuma_fukkou', 'rakugo', 'manbe-forum', 'banno_cup', 'match_maga', 'omotenashimin', 'creadtive_cmproject', '11', 'maggiestokyo', 'japan-friendship-center-nepal', 'CHOSHO-CHODEN', 'SENSHA', 'ootanitoshokan3', 'peace-jam', 'SESSION-with-EARTH', 'kenya-mango-project', 'bullio', 'CULTURE_TRADITION', 'ccj-butaikouen', 'allstar_biwakomusicfes', '1835', 'peru_keyboard', 'tavax2017v', 'rudela_2014', 'rugby', 'tsuepon', 'genkiart2014', 'asayake_2', 'shushokusensenijoari', 'greenlogger', 'tsunagukai', 'wildlife', 'kawaba-mura', '100mothers-in-shizuoka', 'sputnik_01', 'Zimbabwe_HarareChildCareCenter', '1957', 'vegalta_sendai', 'plus-handicap', '2038', 'asobikichi4', 'sakushima-prj', 'FPCJ', 'malawi_scholarship', '2055', 'CambodiaEnglishTextbook', 'EVcafe', 'satoyama-energy-project', 'koriyama', 'tw3231', 'r-battery', 'GIGASTAR', 'linzhiming', 'chiri_karuta', 'mebuki', 'peace_danceNYC', 'kumanoeiga', 'SBPIF2014', 'songenshi', 'odorokimori', 'UZUNI_MWANGAZA', 'yasouchamibyou', 'cambodian_traditional_medicine', 'idfc-mj-2014', 'africanfestakansai', 'kyobashi', 'bangladesh_sanitation', 'space1f', 'kamakurawaki', 'seuriproject', 'jiutamai', 'mopet', 'patess', 'action-inquiry-leadership', 'Ecuador_AMI', 'BiwakoGenryu', 'ukifunemayuori', 'raonijapan', 'save_elephants_forest', 'msjpstrm', '2115syougai-koyou', '1833', '2143', 'archi_to_movie', 'bunseki-tool', 'tozibabamboofactorytakepowdar', 'fujisan-asagiri', 'maikoclub', 'MFF2014', 'crossdesign', 'lovesgallery', 'smallbellsound', 'ivusa-vs-oobana', 'Sfm2', 'redroses', 'lafaek_SGC2014', 'ukiukihappy', 'atelier-lamp', 'HowApp', 'Krocchi-AkaOni', 'sunsun3d', 'livingtogether', 'goto', 'kibounohana', 'yama-no-mi', 'KAMOMEAIR01', 'nico', 'chikaken', 'kawaminami-mozart', 'miyakolive', 'OO', 'shigasato', 'koakagera-obihiro', 'tohokubep', 'jimotankids2014', 'cocokarahouse', 'action-is-a-message', 'ganiyasi', 'otegamiart', 'charitywalk', '2034', 'Smail_e_Academy', 'wasurende-higasinihondaisinsai', 'saigaiit-201410', 'Texasproject', 'otonoha', 'kazaki23ta', 'inago', 'JIES', 'LOVE_TRASHBOX', 'PRIERE', 'enjoymath_pro', 'KANNE', 'otokojuku-miyakojima', 'KanagawaNPOFestival', 'iseoyaki', 'lefuro_kamakura', 'fitness', 'onkochishin', 'gh-touhoku', 'LAOS_NATURAL_RESOURCE', 'iyashi289', 'hanamichi-library', 'process', 'petitmaman', 'maniban', 'chibaichiharaCD', 'singurumm', 'waratteiinoda', 'fof', 'un-chi-dance', 'yurarhythm', '41913', 'minority', '2223', 'arimatsu-shibori', 'toshima-kioku', 'shokurinsai', 'dorokabura', 'gifukara', 'hidatakayama_MEMORO', 'taketoyo-rugbyschool', 'shibuya-wakamono-meeting', '5kasyou', 'haru-single', 'rakurakumom', 'kizunarestaurant', '2059', 'santa-run', 'medal-for-children', 'ne_mu_ri', 'umamamatsuri', '2164', 'philippine_earthquake_veneer', 'amakusacwp', 'morinogakkou_toshinoukids', 'i-tara-rarara', 'ongakunomachi', 'KuradamaCafe', '2290', 'tokara-uma', 'inaka', 'gondola', 'yasou', 'yokohama-ido', 'jobjoy', 'Baseballsupport', '2343', 'kosodatepeer', 'gangstar', 'burkinafaso', 'dagashiya', 'manabi1204', 'gosfes', 'sharelifedesign', 'paralym-rockfes', 'kyodoai', 'YLCA-LAB', 'atumarorai', 'donfesujapan', 'uenohara-kinua', 'fukushima_smile-message', 'syusyoku-sokushin', 'okjh65fd', '2422', 'clubpot', 'kobara_project', 'rescue_sunameri', 'chikyu-genkimura', 'abe-gold', 'indaisen2014', 'kodomosien', 'tyurazima365', 'tayu', 'itrec-pro', 'cmd-youyou', 'Thank_you_for_your_kindness', 'yuusui-hotaru', 'artsiteyasato', 'research-bloodtype', 'cocoromark-project-kokororadio', 'youkai_youkai-chi', '1885', 'totsukawa_sugi', '2403', 'haiko_groove', 'fun-saxophonic-lab', 'deaf-art', 'HMHM5525', 'coms', 'fujigokoskate', 'komoriuta-15cd', 'minamo34', 'hassy84-84', 'aozoraegao', 'komorebi', 'HASHINOE2014', 're-kobe117', '2096', 'nyusankinmai', 'seppyou', 'quichafes2014', 'zenibako-burger', 'sanenan', 'kumonoito', 'maemuki3939', 'kominkaofuro', '2261', '1897', 'saharaproject', 'dipjam-pekopekofarm-nagoya', 'snadviser', 'babybirthproject', 'kadappeshi', 'kominka-photobook', 'popolo', '1875', '2139', 'kasumi_pearl', '2146', 'picopico', 'okinawatour', 'pino', 'noentry_cinema', 'kamenoko', 'yumeprojpct', 'taiyounoiesien', '1818', 'cue', 'nagoya_language_lovers', 'haisaiobaaq', 'a2107608', '2344', '2287', 'flowerproject', 'onbu-greenartproject']

projects = ['2014-10-01']

# escape double quotaion for CSV
def escape_double_quote (s)
  return '""' if s.nil?
  if ( /"/ =~ s )
    return '"' + s.gsub('"','""') + '"'
  else
    return '"' + s + '"'
  end
end


# write header
header = ["url", "success_date", "close_date", "target", "backers", "owner"]
puts header.inspect.gsub('[','').gsub(']','')

projects.each do |project_id|
  url = base_url + project_id
  row = escape_double_quote(url)

  begin
    doc = Nokogiri::HTML(open(url))
  rescue
    row << "," + escape_double_quote("page not found")
  else
    #success_date
    row << "," + escape_double_quote(doc.css("#project-success-message > span").text.scan(/\d{4}年\d{1,2}月\d{1,2}日/).first)

    #close_date
    row << "," + escape_double_quote(doc.css("#due-date-wrap").text.scan(/\d{1,2}月\d{1,2}日（.）午.\d{1,2}:\d{1,2}/).first)

    numbers = doc.css("#stats_wrap").css("span.num").to_a
    numbers.insert(2, "") if numbers.length == 3

    #target
    row << "," + escape_double_quote(numbers[1].text.strip)

    #backers
    row << "," + escape_double_quote(numbers[3].text.strip)

    #owner
    row << "," + escape_double_quote(doc.css("h3.name").text)

    puts row
  ensure
  end
end

